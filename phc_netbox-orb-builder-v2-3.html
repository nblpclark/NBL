<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetBox ORB Agent Discovery Builder</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;
        
        const Icon = ({ d, className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2">
                <path strokeLinecap="round" strokeLinejoin="round" d={d} />
            </svg>
        );

        const App = () => {
            const [tab, setTab] = useState('common');
            
            // Common Settings
            const [common, setCommon] = useState({
                configManager: 'local',
                agentName: 'enterprise_agent_01',
                enableNetworkDiscovery: true,
                enableDeviceDiscovery: true
            });
            
            // Environment Variables
            const [env, setEnv] = useState({
                diodeTarget: 'https://your-instance.netboxcloud.com/diode',
                diodeClientId: '',
                diodeClientSecret: ''
            });

            // Credential Management
            const [credentialMode, setCredentialMode] = useState('env'); // 'env', 'vault', 'inline'
            const [vaultConfig, setVaultConfig] = useState({
                address: 'https://vault.example.com:8200',
                authMethod: 'token', // 'token', 'approle', 'kubernetes'
                token: '',
                roleId: '',
                secretId: '',
                kubernetesRole: '',
                namespace: 'secret'
            });

            // Device Credentials
            const [deviceCredentials, setDeviceCredentials] = useState([{
                name: 'default_credentials',
                username: 'admin',
                password: '',
                enablePassword: '',
                vaultPath: 'secret/data/network/default',
                usernameKey: 'username',
                passwordKey: 'password',
                enablePasswordKey: 'enable_password'
            }]);
            
            // Network Discovery Policies
            const [networkPolicies, setNetworkPolicies] = useState([{
                name: 'headquarters',
                schedule: '0 */2 * * *',
                scheduleComment: 'Every 2 hours',
                timeout: 5,
                fastMode: false,
                targets: ['192.168.0.0/16', '10.0.0.0/8']
            }]);
            
            // Device Discovery Policies
            const [devicePolicies, setDevicePolicies] = useState([{
                name: 'cisco_devices',
                schedule: '0 */6 * * *',
                scheduleComment: 'Every 6 hours',
                defaultSite: 'Headquarters',
                credentialRef: 'default_credentials',
                devices: [{
                    driver: 'ios',
                    hostname: '192.168.1.1',
                    credentialOverride: '' // Optional per-device credential
                }]
            }]);

            const genEnv = () => {
                let envContent = `# ============================================================================
# NetBox ORB Agent Environment Variables
# Generated: ${new Date().toISOString()}
# ============================================================================
# Security: chmod 600 .env && echo ".env" >> .gitignore
# ============================================================================

# Diode Connection Settings
DIODE_TARGET=${env.diodeTarget}
DIODE_CLIENT_ID=${env.diodeClientId}
DIODE_CLIENT_SECRET=${env.diodeClientSecret}
`;

                if (credentialMode === 'env') {
                    envContent += `
# Device Authentication Credentials
# Multiple credential sets for different device groups
`;
                    deviceCredentials.forEach(cred => {
                        const credPrefix = cred.name.toUpperCase().replace(/[^A-Z0-9]/g, '_');
                        envContent += `
# Credential Set: ${cred.name}
${credPrefix}_USERNAME=${cred.username}
${credPrefix}_PASSWORD=${cred.password}`;
                        if (cred.enablePassword) {
                            envContent += `
${credPrefix}_ENABLE_PASSWORD=${cred.enablePassword}`;
                        }
                        envContent += '\n';
                    });
                } else if (credentialMode === 'vault') {
                    envContent += `
# HashiCorp Vault Configuration
VAULT_ADDR=${vaultConfig.address}`;
                    
                    if (vaultConfig.authMethod === 'token') {
                        envContent += `
VAULT_TOKEN=${vaultConfig.token}`;
                    } else if (vaultConfig.authMethod === 'approle') {
                        envContent += `
VAULT_ROLE_ID=${vaultConfig.roleId}
VAULT_SECRET_ID=${vaultConfig.secretId}`;
                    } else if (vaultConfig.authMethod === 'kubernetes') {
                        envContent += `
VAULT_KUBERNETES_ROLE=${vaultConfig.kubernetesRole}`;
                    }
                    
                    envContent += `
VAULT_NAMESPACE=${vaultConfig.namespace}
`;
                }

                envContent += `
# ============================================================================
# Usage Instructions:
# 
# 1. Export all variables:
#    export $(cat .env | xargs)
#
# 2. Or source the file:
#    source .env
#
# 3. Run the ORB agent:
#    docker run --net=host \\
#      -v $(pwd):/opt/orb/ \\
#      -e DIODE_TARGET \\
#      -e DIODE_CLIENT_ID \\
#      -e DIODE_CLIENT_SECRET \\`;

                if (credentialMode === 'env') {
                    deviceCredentials.forEach(cred => {
                        const credPrefix = cred.name.toUpperCase().replace(/[^A-Z0-9]/g, '_');
                        envContent += `
#      -e ${credPrefix}_USERNAME \\
#      -e ${credPrefix}_PASSWORD \\`;
                        if (cred.enablePassword) {
                            envContent += `
#      -e ${credPrefix}_ENABLE_PASSWORD \\`;
                        }
                    });
                } else if (credentialMode === 'vault') {
                    envContent += `
#      -e VAULT_ADDR \\
#      -e VAULT_TOKEN \\
#      -e VAULT_NAMESPACE \\`;
                }

                envContent += `
#      netboxlabs/orb-agent:latest run -c /opt/orb/agent.yaml
# ============================================================================`;

                return envContent;
            };

            const genYaml = () => {
                let yaml = `# ============================================================================
# NetBox ORB Agent Configuration
# Generated: ${new Date().toISOString()}
# ============================================================================
# Documentation: https://netboxlabs.com/docs/orb-agent/
# ============================================================================

orb:
  config_manager:
    active: ${common.configManager}
  
  backends:`;

                if (common.enableNetworkDiscovery) {
                    yaml += `
    network_discovery:`;
                }

                if (common.enableDeviceDiscovery) {
                    yaml += `
    device_discovery:`;
                }

                yaml += `
  
  common:
    diode:
      target: \${DIODE_TARGET}
      client_id: \${DIODE_CLIENT_ID}
      client_secret: \${DIODE_CLIENT_SECRET}
      agent_name: ${common.agentName}
`;

                // Add credential configurations
                if (credentialMode === 'vault') {
                    yaml += `
    # HashiCorp Vault Integration
    vault:
      address: \${VAULT_ADDR}
      auth_method: ${vaultConfig.authMethod}`;
                    
                    if (vaultConfig.authMethod === 'token') {
                        yaml += `
      token: \${VAULT_TOKEN}`;
                    } else if (vaultConfig.authMethod === 'approle') {
                        yaml += `
      role_id: \${VAULT_ROLE_ID}
      secret_id: \${VAULT_SECRET_ID}`;
                    } else if (vaultConfig.authMethod === 'kubernetes') {
                        yaml += `
      kubernetes_role: \${VAULT_KUBERNETES_ROLE}`;
                    }
                    
                    yaml += `
      namespace: ${vaultConfig.namespace}
`;
                }

                // Define credential sets
                if (credentialMode !== 'inline' && deviceCredentials.length > 0) {
                    yaml += `
    # Credential Definitions
    credentials:`;
                    
                    deviceCredentials.forEach(cred => {
                        yaml += `
      ${cred.name}:`;
                        
                        if (credentialMode === 'env') {
                            const credPrefix = cred.name.toUpperCase().replace(/[^A-Z0-9]/g, '_');
                            yaml += `
        username: \${${credPrefix}_USERNAME}
        password: \${${credPrefix}_PASSWORD}`;
                            if (cred.enablePassword) {
                                yaml += `
        enable_password: \${${credPrefix}_ENABLE_PASSWORD}`;
                            }
                        } else if (credentialMode === 'vault') {
                            yaml += `
        vault_path: ${cred.vaultPath}
        username_key: ${cred.usernameKey}
        password_key: ${cred.passwordKey}`;
                            if (cred.enablePasswordKey) {
                                yaml += `
        enable_password_key: ${cred.enablePasswordKey}`;
                            }
                        }
                    });
                }

                yaml += `
  
  policies:`;

                // Network Discovery Policies
                if (common.enableNetworkDiscovery && networkPolicies.length > 0) {
                    yaml += `
    network_discovery:`;
                    networkPolicies.forEach(policy => {
                        yaml += `
      ${policy.name}:
        config:
          schedule: "${policy.schedule}"  # ${policy.scheduleComment}
          timeout: ${policy.timeout}`;
                        if (policy.fastMode) {
                            yaml += `
          fast_mode: true  # Faster scans with reduced accuracy`;
                        }
                        yaml += `
        scope:
          targets:`;
                        policy.targets.forEach(target => {
                            yaml += `
            - "${target}"`;
                        });
                    });
                }

                // Device Discovery Policies
                if (common.enableDeviceDiscovery && devicePolicies.length > 0) {
                    yaml += `
    device_discovery:`;
                    devicePolicies.forEach(policy => {
                        yaml += `
      ${policy.name}:
        config:
          schedule: "${policy.schedule}"  # ${policy.scheduleComment}`;
                        
                        if (credentialMode !== 'inline' && policy.credentialRef) {
                            yaml += `
          credentials: ${policy.credentialRef}  # Reference to credential set`;
                        }
                        
                        yaml += `
        defaults:
          site: ${policy.defaultSite}
        scope:`;
                        
                        policy.devices.forEach(device => {
                            yaml += `
          - driver: ${device.driver}
            hostname: ${device.hostname}`;
                            
                            if (credentialMode === 'inline') {
                                const credPrefix = 'DEFAULT_CREDENTIALS';
                                yaml += `
            username: \${${credPrefix}_USERNAME}
            password: \${${credPrefix}_PASSWORD}`;
                            } else if (device.credentialOverride) {
                                yaml += `
            credentials: ${device.credentialOverride}  # Override default credentials`;
                            }
                        });
                    });
                }

                return yaml;
            };

            const dl = (content, name) => {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-xl shadow-xl p-8 mb-6">
                            <div className="mb-6">
                                <h1 className="text-3xl font-bold text-gray-900 mb-2">
                                    NetBox ORB Agent Discovery Builder
                                </h1>
                                <p className="text-gray-600">
                                    Generate ORB agent configuration for NetBox Discovery (Network & Device Discovery)
                                </p>
                            </div>

                            {/* Tabs */}
                            <div className="flex gap-2 mb-6 border-b overflow-x-auto">
                                {[
                                    { id: 'common', label: 'Common Settings' },
                                    { id: 'credentials', label: 'Credentials' },
                                    { id: 'network-discovery', label: 'Network Discovery' },
                                    { id: 'device-discovery', label: 'Device Discovery' }
                                ].map(t => (
                                    <button key={t.id} onClick={() => setTab(t.id)}
                                        className={`px-6 py-3 font-semibold whitespace-nowrap transition-all ${
                                            tab === t.id ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-gray-900'
                                        }`}>
                                        {t.label}
                                    </button>
                                ))}
                            </div>

                            {/* Common Settings */}
                            {tab === 'common' && (
                                <div className="space-y-6">
                                    <div>
                                        <h2 className="text-xl font-bold text-gray-800 mb-1">Common Configuration</h2>
                                        <p className="text-sm text-gray-600 mb-4">
                                            Core ORB agent settings and Diode connection
                                        </p>
                                    </div>

                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    Config Manager
                                                    <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                        How the agent reads its configuration
                                                    </span>
                                                </label>
                                                <select 
                                                    value={common.configManager} 
                                                    onChange={e => setCommon({...common, configManager: e.target.value})}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="local">local - Read from YAML file</option>
                                                    <option value="git">git - Read from Git repository</option>
                                                </select>
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    Agent Name
                                                    <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                        Unique identifier for this agent instance
                                                    </span>
                                                </label>
                                                <input 
                                                    type="text"
                                                    value={common.agentName}
                                                    onChange={e => setCommon({...common, agentName: e.target.value})}
                                                    placeholder="enterprise_agent_01"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                        </div>

                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    Diode Target URL
                                                    <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                        NetBox Diode endpoint (grpc:// or https://)
                                                    </span>
                                                </label>
                                                <input 
                                                    type="text"
                                                    value={env.diodeTarget}
                                                    onChange={e => setEnv({...env, diodeTarget: e.target.value})}
                                                    placeholder="https://your-instance.netboxcloud.com/diode"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>

                                            <div className="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Client ID
                                                    </label>
                                                    <input 
                                                        type="text"
                                                        value={env.diodeClientId}
                                                        onChange={e => setEnv({...env, diodeClientId: e.target.value})}
                                                        placeholder="client-id"
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Client Secret
                                                    </label>
                                                    <input 
                                                        type="password"
                                                        value={env.diodeClientSecret}
                                                        onChange={e => setEnv({...env, diodeClientSecret: e.target.value})}
                                                        placeholder="client-secret"
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                                        <h3 className="text-sm font-semibold text-gray-800 mb-3">Enable Discovery Backends</h3>
                                        <div className="space-y-3">
                                            <label className="flex items-start gap-3">
                                                <input
                                                    type="checkbox"
                                                    checked={common.enableNetworkDiscovery}
                                                    onChange={e => setCommon({...common, enableNetworkDiscovery: e.target.checked})}
                                                    className="mt-1 w-4 h-4 text-blue-600 rounded"
                                                />
                                                <div>
                                                    <div className="font-medium text-gray-900">Network Discovery</div>
                                                    <div className="text-sm text-gray-600">Scan network ranges to discover active hosts using ICMP, TCP, UDP</div>
                                                </div>
                                            </label>
                                            <label className="flex items-start gap-3">
                                                <input
                                                    type="checkbox"
                                                    checked={common.enableDeviceDiscovery}
                                                    onChange={e => setCommon({...common, enableDeviceDiscovery: e.target.checked})}
                                                    className="mt-1 w-4 h-4 text-blue-600 rounded"
                                                />
                                                <div>
                                                    <div className="font-medium text-gray-900">Device Discovery</div>
                                                    <div className="text-sm text-gray-600">Connect to devices via SSH to extract detailed configuration and state</div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Credentials Tab */}
                            {tab === 'credentials' && (
                                <div className="space-y-6">
                                    <div>
                                        <h2 className="text-xl font-bold text-gray-800 mb-1">Credential Management</h2>
                                        <p className="text-sm text-gray-600 mb-4">
                                            Configure how device credentials are stored and accessed
                                        </p>
                                    </div>

                                    {/* Credential Mode Selection */}
                                    <div className="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                                        <h3 className="text-sm font-semibold text-gray-800 mb-3">Credential Storage Method</h3>
                                        <div className="space-y-3">
                                            <label className="flex items-start gap-3 cursor-pointer">
                                                <input
                                                    type="radio"
                                                    name="credentialMode"
                                                    value="env"
                                                    checked={credentialMode === 'env'}
                                                    onChange={e => setCredentialMode(e.target.value)}
                                                    className="mt-1 w-4 h-4 text-blue-600"
                                                />
                                                <div className="flex-1">
                                                    <div className="font-medium text-gray-900">Environment Variables</div>
                                                    <div className="text-sm text-gray-600">Store credentials in .env file with environment variables</div>
                                                    <div className="text-xs text-gray-500 mt-1">‚úì Simple setup ‚Ä¢ ‚úì Good for dev/test ‚Ä¢ ‚ö† Manual rotation</div>
                                                </div>
                                            </label>
                                            <label className="flex items-start gap-3 cursor-pointer">
                                                <input
                                                    type="radio"
                                                    name="credentialMode"
                                                    value="vault"
                                                    checked={credentialMode === 'vault'}
                                                    onChange={e => setCredentialMode(e.target.value)}
                                                    className="mt-1 w-4 h-4 text-blue-600"
                                                />
                                                <div className="flex-1">
                                                    <div className="font-medium text-gray-900">HashiCorp Vault</div>
                                                    <div className="text-sm text-gray-600">Retrieve credentials dynamically from HashiCorp Vault</div>
                                                    <div className="text-xs text-gray-500 mt-1">‚úì Centralized secrets ‚Ä¢ ‚úì Auto rotation ‚Ä¢ ‚úì Audit logging ‚Ä¢ ‚úì Production-ready</div>
                                                </div>
                                            </label>
                                            <label className="flex items-start gap-3 cursor-pointer">
                                                <input
                                                    type="radio"
                                                    name="credentialMode"
                                                    value="inline"
                                                    checked={credentialMode === 'inline'}
                                                    onChange={e => setCredentialMode(e.target.value)}
                                                    className="mt-1 w-4 h-4 text-blue-600"
                                                />
                                                <div className="flex-1">
                                                    <div className="font-medium text-gray-900">Inline (Legacy)</div>
                                                    <div className="text-sm text-gray-600">Store credentials directly in configuration file</div>
                                                    <div className="text-xs text-red-600 mt-1">‚ö† Not recommended ‚Ä¢ Security risk ‚Ä¢ Use only for testing</div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>

                                    {/* HashiCorp Vault Configuration */}
                                    {credentialMode === 'vault' && (
                                        <div className="p-5 bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg border-2 border-purple-200">
                                            <h3 className="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                                <Icon d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" className="w-5 h-5 text-purple-600" />
                                                HashiCorp Vault Configuration
                                            </h3>

                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Vault Address
                                                        <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                            Full URL to your Vault server
                                                        </span>
                                                    </label>
                                                    <input 
                                                        type="text"
                                                        value={vaultConfig.address}
                                                        onChange={e => setVaultConfig({...vaultConfig, address: e.target.value})}
                                                        placeholder="https://vault.example.com:8200"
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                                    />
                                                </div>

                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Authentication Method
                                                        <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                            How the agent authenticates to Vault
                                                        </span>
                                                    </label>
                                                    <select 
                                                        value={vaultConfig.authMethod}
                                                        onChange={e => setVaultConfig({...vaultConfig, authMethod: e.target.value})}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                                    >
                                                        <option value="token">Token - Direct token authentication</option>
                                                        <option value="approle">AppRole - Role-based authentication</option>
                                                        <option value="kubernetes">Kubernetes - Service account authentication</option>
                                                    </select>
                                                </div>

                                                {vaultConfig.authMethod === 'token' && (
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                                            Vault Token
                                                            <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                                Token with read permissions for secret paths
                                                            </span>
                                                        </label>
                                                        <input 
                                                            type="password"
                                                            value={vaultConfig.token}
                                                            onChange={e => setVaultConfig({...vaultConfig, token: e.target.value})}
                                                            placeholder="hvs.XXXXXXXXXXXXX"
                                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                                                        />
                                                    </div>
                                                )}

                                                {vaultConfig.authMethod === 'approle' && (
                                                    <div className="grid md:grid-cols-2 gap-4">
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                                Role ID
                                                                <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                                    AppRole role identifier
                                                                </span>
                                                            </label>
                                                            <input 
                                                                type="text"
                                                                value={vaultConfig.roleId}
                                                                onChange={e => setVaultConfig({...vaultConfig, roleId: e.target.value})}
                                                                placeholder="role-id-xxxxx"
                                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                                                            />
                                                        </div>
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                                Secret ID
                                                                <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                                    AppRole secret identifier
                                                                </span>
                                                            </label>
                                                            <input 
                                                                type="password"
                                                                value={vaultConfig.secretId}
                                                                onChange={e => setVaultConfig({...vaultConfig, secretId: e.target.value})}
                                                                placeholder="secret-id-xxxxx"
                                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                                                            />
                                                        </div>
                                                    </div>
                                                )}

                                                {vaultConfig.authMethod === 'kubernetes' && (
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                                            Kubernetes Role
                                                            <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                                Vault role bound to K8s service account
                                                            </span>
                                                        </label>
                                                        <input 
                                                            type="text"
                                                            value={vaultConfig.kubernetesRole}
                                                            onChange={e => setVaultConfig({...vaultConfig, kubernetesRole: e.target.value})}
                                                            placeholder="orb-agent-role"
                                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                                        />
                                                    </div>
                                                )}

                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Vault Namespace
                                                        <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                            Base path for secrets (usually "secret" for KV v2)
                                                        </span>
                                                    </label>
                                                    <input 
                                                        type="text"
                                                        value={vaultConfig.namespace}
                                                        onChange={e => setVaultConfig({...vaultConfig, namespace: e.target.value})}
                                                        placeholder="secret"
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                                    />
                                                </div>
                                            </div>

                                            <div className="mt-4 p-3 bg-purple-100 rounded-lg">
                                                <h4 className="text-xs font-semibold text-purple-900 mb-2">üîê Vault Setup Example</h4>
                                                <pre className="text-xs text-purple-800 overflow-x-auto"><code>{`# Enable KV v2 secrets engine
vault secrets enable -path=secret kv-v2

# Create a policy for ORB agent
vault policy write orb-agent - <<EOF
path "secret/data/network/*" {
  capabilities = ["read"]
}
EOF

# Create token with policy
vault token create -policy=orb-agent`}</code></pre>
                                            </div>
                                        </div>
                                    )}

                                    {/* Device Credentials */}
                                    {credentialMode !== 'inline' && (
                                        <div>
                                            <div className="flex items-center justify-between mb-3">
                                                <div>
                                                    <h3 className="text-lg font-semibold text-gray-800">Device Credential Sets</h3>
                                                    <p className="text-sm text-gray-600">Define credential sets for different device groups</p>
                                                </div>
                                                <button 
                                                    onClick={() => setDeviceCredentials([...deviceCredentials, {
                                                        name: `credentials_${deviceCredentials.length + 1}`,
                                                        username: 'admin',
                                                        password: '',
                                                        enablePassword: '',
                                                        vaultPath: `secret/data/network/set${deviceCredentials.length + 1}`,
                                                        usernameKey: 'username',
                                                        passwordKey: 'password',
                                                        enablePasswordKey: 'enable_password'
                                                    }])}
                                                    className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2 shadow-md"
                                                >
                                                    <Icon d="M12 4v16m8-8H4" className="w-4 h-4" />
                                                    Add Credential Set
                                                </button>
                                            </div>

                                            {deviceCredentials.map((cred, idx) => (
                                                <div key={idx} className="p-5 bg-gradient-to-br from-gray-50 to-green-50 rounded-lg border-2 border-gray-200 shadow-sm mb-3">
                                                    <div className="flex justify-between items-start mb-4">
                                                        <div>
                                                            <h4 className="font-semibold text-gray-800 text-lg">Credential Set: {cred.name}</h4>
                                                            <p className="text-sm text-gray-600">
                                                                {credentialMode === 'env' ? 'Stored in environment variables' : 'Retrieved from Vault'}
                                                            </p>
                                                        </div>
                                                        <button 
                                                            onClick={() => setDeviceCredentials(deviceCredentials.filter((_, i) => i !== idx))}
                                                            className="text-red-600 hover:text-red-800 hover:bg-red-50 p-2 rounded"
                                                        >
                                                            <Icon d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" className="w-5 h-5" />
                                                        </button>
                                                    </div>

                                                    <div className="grid md:grid-cols-2 gap-4">
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                                Credential Set Name <span className="text-red-500">*</span>
                                                                <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                                    Unique identifier (alphanumeric and underscores)
                                                                </span>
                                                            </label>
                                                            <input 
                                                                type="text"
                                                                value={cred.name}
                                                                onChange={e => {
                                                                    const updated = [...deviceCredentials];
                                                                    updated[idx].name = e.target.value.replace(/[^a-zA-Z0-9_]/g, '_');
                                                                    setDeviceCredentials(updated);
                                                                }}
                                                                placeholder="production_devices"
                                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 font-mono"
                                                            />
                                                        </div>

                                                        {credentialMode === 'env' ? (
                                                            <>
                                                                <div>
                                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                                        Username
                                                                    </label>
                                                                    <input 
                                                                        type="text"
                                                                        value={cred.username}
                                                                        onChange={e => {
                                                                            const updated = [...deviceCredentials];
                                                                            updated[idx].username = e.target.value;
                                                                            setDeviceCredentials(updated);
                                                                        }}
                                                                        placeholder="admin"
                                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                                    />
                                                                </div>
                                                                <div>
                                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                                        Password
                                                                    </label>
                                                                    <input 
                                                                        type="password"
                                                                        value={cred.password}
                                                                        onChange={e => {
                                                                            const updated = [...deviceCredentials];
                                                                            updated[idx].password = e.target.value;
                                                                            setDeviceCredentials(updated);
                                                                        }}
                                                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                                    />
                                                                </div>
                                                                <div>
                                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                                        Enable Password (Optional)
                                                                        <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                                            For devices requiring enable mode
                                                                        </span>
                                                                    </label>
                                                                    <input 
                                                                        type="password"
                                                                        value={cred.enablePassword}
                                                                        onChange={e => {
                                                                            const updated = [...deviceCredentials];
                                                                            updated[idx].enablePassword = e.target.value;
                                                                            setDeviceCredentials(updated);
                                                                        }}
                                                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                                    />
                                                                </div>
                                                            </>
                                                        ) : (
                                                            <>
                                                                <div className="md:col-span-2">
                                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                                        Vault Secret Path
                                                                        <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                                            Full path to the secret in Vault (e.g., secret/data/network/production)
                                                                        </span>
                                                                    </label>
                                                                    <input 
                                                                        type="text"
                                                                        value={cred.vaultPath}
                                                                        onChange={e => {
                                                                            const updated = [...deviceCredentials];
                                                                            updated[idx].vaultPath = e.target.value;
                                                                            setDeviceCredentials(updated);
                                                                        }}
                                                                        placeholder="secret/data/network/production"
                                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                                                                    />
                                                                </div>
                                                                <div>
                                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                                        Username Key
                                                                        <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                                            Field name in Vault secret
                                                                        </span>
                                                                    </label>
                                                                    <input 
                                                                        type="text"
                                                                        value={cred.usernameKey}
                                                                        onChange={e => {
                                                                            const updated = [...deviceCredentials];
                                                                            updated[idx].usernameKey = e.target.value;
                                                                            setDeviceCredentials(updated);
                                                                        }}
                                                                        placeholder="username"
                                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                                                                    />
                                                                </div>
                                                                <div>
                                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                                        Password Key
                                                                        <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                                            Field name in Vault secret
                                                                        </span>
                                                                    </label>
                                                                    <input 
                                                                        type="text"
                                                                        value={cred.passwordKey}
                                                                        onChange={e => {
                                                                            const updated = [...deviceCredentials];
                                                                            updated[idx].passwordKey = e.target.value;
                                                                            setDeviceCredentials(updated);
                                                                        }}
                                                                        placeholder="password"
                                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                                                                    />
                                                                </div>
                                                                <div>
                                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                                        Enable Password Key (Optional)
                                                                        <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                                            Field name for enable password
                                                                        </span>
                                                                    </label>
                                                                    <input 
                                                                        type="text"
                                                                        value={cred.enablePasswordKey}
                                                                        onChange={e => {
                                                                            const updated = [...deviceCredentials];
                                                                            updated[idx].enablePasswordKey = e.target.value;
                                                                            setDeviceCredentials(updated);
                                                                        }}
                                                                        placeholder="enable_password"
                                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                                                                    />
                                                                </div>
                                                            </>
                                                        )}
                                                    </div>

                                                    {credentialMode === 'vault' && (
                                                        <div className="mt-3 p-3 bg-white rounded border border-purple-200">
                                                            <p className="text-xs font-semibold text-purple-900 mb-1">Example Vault Secret Structure:</p>
                                                            <pre className="text-xs text-purple-800 overflow-x-auto"><code>{`vault kv put ${cred.vaultPath.replace('data/', '')} \\
  ${cred.usernameKey}="${cred.username || 'admin'}" \\
  ${cred.passwordKey}="your-password"${cred.enablePasswordKey ? ` \\\n  ${cred.enablePasswordKey}="your-enable-password"` : ''}`}</code></pre>
                                                        </div>
                                                    )}
                                                </div>
                                            ))}

                                            {deviceCredentials.length === 0 && (
                                                <div className="text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
                                                    <p className="text-gray-600 mb-3">No credential sets configured</p>
                                                    <button 
                                                        onClick={() => setDeviceCredentials([{
                                                            name: 'default_credentials',
                                                            username: 'admin',
                                                            password: '',
                                                            enablePassword: '',
                                                            vaultPath: 'secret/data/network/default',
                                                            usernameKey: 'username',
                                                            passwordKey: 'password',
                                                            enablePasswordKey: 'enable_password'
                                                        }])}
                                                        className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                                    >
                                                        Create First Credential Set
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {credentialMode === 'inline' && (
                                        <div className="p-4 bg-red-50 border-2 border-red-300 rounded-lg">
                                            <h3 className="font-semibold text-red-900 mb-2 flex items-center gap-2">
                                                <Icon d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" className="w-5 h-5" />
                                                Warning: Inline Credentials Not Recommended
                                            </h3>
                                            <p className="text-sm text-red-800 mb-2">
                                                Storing credentials directly in the configuration file is a security risk. Credentials will be stored in plain text in the YAML file.
                                            </p>
                                            <p className="text-xs text-red-700">
                                                This mode is provided for backward compatibility only. Use Environment Variables or HashiCorp Vault for production deployments.
                                            </p>
                                        </div>
                                    )}

                                    <div className="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                        <h3 className="text-sm font-semibold text-blue-900 mb-2">üí° Credential Management Best Practices</h3>
                                        <ul className="text-sm text-blue-800 space-y-1">
                                            <li>‚Ä¢ <strong>Environment Variables:</strong> Best for simple deployments, development, and testing</li>
                                            <li>‚Ä¢ <strong>HashiCorp Vault:</strong> Recommended for production with centralized secret management</li>
                                            <li>‚Ä¢ <strong>Multiple Credential Sets:</strong> Use different credentials for different device groups or security zones</li>
                                            <li>‚Ä¢ <strong>Rotation:</strong> Vault enables automatic credential rotation and audit logging</li>
                                        </ul>
                                    </div>
                                </div>
                            )}

                            {/* Network Discovery - Simplified for space */}
                            {tab === 'network-discovery' && (
                                <div className="space-y-6">
                                    <div className="flex items-start justify-between">
                                        <div>
                                            <h2 className="text-xl font-bold text-gray-800 mb-1">Network Discovery Policies</h2>
                                            <p className="text-sm text-gray-600">
                                                Define network ranges to scan for active hosts and devices
                                            </p>
                                        </div>
                                        <button 
                                            onClick={() => setNetworkPolicies([...networkPolicies, {
                                                name: 'new_policy', schedule: '0 * * * *', scheduleComment: 'Every hour', timeout: 5, fastMode: false, targets: ['10.0.0.0/24']
                                            }])}
                                            className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-md"
                                        >
                                            <Icon d="M12 4v16m8-8H4" className="w-4 h-4" />
                                            Add Policy
                                        </button>
                                    </div>

                                    {!common.enableNetworkDiscovery && (
                                        <div className="p-4 bg-amber-50 border border-amber-200 rounded-lg">
                                            <p className="text-sm text-amber-800">
                                                ‚ö†Ô∏è Network Discovery is currently disabled. Enable it in <strong>Common Settings</strong> to use these policies.
                                            </p>
                                        </div>
                                    )}

                                    {networkPolicies.map((policy, i) => (
                                        <div key={i} className="p-5 bg-gradient-to-br from-gray-50 to-blue-50 rounded-lg border-2 border-gray-200 shadow-sm">
                                            <div className="flex justify-between items-start mb-4">
                                                <div>
                                                    <h4 className="font-semibold text-gray-800 text-lg">Network Policy {i + 1}</h4>
                                                    <p className="text-sm text-gray-600">Configure network scanning parameters</p>
                                                </div>
                                                <button 
                                                    onClick={() => setNetworkPolicies(networkPolicies.filter((_, idx) => idx !== i))}
                                                    className="text-red-600 hover:text-red-800 hover:bg-red-50 p-2 rounded"
                                                >
                                                    <Icon d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" className="w-5 h-5" />
                                                </button>
                                            </div>

                                            <div className="grid md:grid-cols-3 gap-4 mb-4">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Policy Name <span className="text-red-500">*</span>
                                                    </label>
                                                    <input 
                                                        type="text"
                                                        value={policy.name}
                                                        onChange={e => {
                                                            const updated = [...networkPolicies];
                                                            updated[i].name = e.target.value;
                                                            setNetworkPolicies(updated);
                                                        }}
                                                        placeholder="headquarters"
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Schedule Type <span className="text-red-500">*</span>
                                                    </label>
                                                    <select
                                                        value={policy.schedule}
                                                        onChange={e => {
                                                            const updated = [...networkPolicies];
                                                            updated[i].schedule = e.target.value;
                                                            const scheduleMap = {
                                                                '*/15 * * * *': 'Every 15 minutes',
                                                                '*/30 * * * *': 'Every 30 minutes',
                                                                '0 * * * *': 'Every hour',
                                                                '0 */2 * * *': 'Every 2 hours',
                                                                '0 */4 * * *': 'Every 4 hours',
                                                                '0 */6 * * *': 'Every 6 hours',
                                                                '0 */12 * * *': 'Every 12 hours',
                                                                '0 0 * * *': 'Daily at midnight',
                                                                '0 9 * * *': 'Daily at 9 AM',
                                                                '0 0 * * 0': 'Weekly on Sunday',
                                                                'custom': 'Custom cron expression'
                                                            };
                                                            updated[i].scheduleComment = scheduleMap[e.target.value] || 'Custom schedule';
                                                            setNetworkPolicies(updated);
                                                        }}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                    >
                                                        <option value="*/15 * * * *">Every 15 minutes</option>
                                                        <option value="*/30 * * * *">Every 30 minutes</option>
                                                        <option value="0 * * * *">Every hour</option>
                                                        <option value="0 */2 * * *">Every 2 hours</option>
                                                        <option value="0 */4 * * *">Every 4 hours</option>
                                                        <option value="0 */6 * * *">Every 6 hours</option>
                                                        <option value="0 */12 * * *">Every 12 hours</option>
                                                        <option value="0 0 * * *">Daily at midnight</option>
                                                        <option value="0 9 * * *">Daily at 9 AM</option>
                                                        <option value="0 0 * * 0">Weekly on Sunday</option>
                                                        <option value="custom">Custom cron expression</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Timeout (minutes)
                                                    </label>
                                                    <input 
                                                        type="number"
                                                        value={policy.timeout}
                                                        onChange={e => {
                                                            const updated = [...networkPolicies];
                                                            updated[i].timeout = parseInt(e.target.value);
                                                            setNetworkPolicies(updated);
                                                        }}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                    />
                                                </div>
                                            </div>

                                            {policy.schedule === 'custom' && (
                                                <div className="mb-4">
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Custom Cron Expression <span className="text-red-500">*</span>
                                                    </label>
                                                    <input 
                                                        type="text"
                                                        value={policy.schedule === 'custom' ? '' : policy.schedule}
                                                        onChange={e => {
                                                            const updated = [...networkPolicies];
                                                            updated[i].schedule = e.target.value;
                                                            setNetworkPolicies(updated);
                                                        }}
                                                        placeholder="0 */3 * * * (Every 3 hours)"
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                                                    />
                                                    <p className="text-xs text-gray-500 mt-1.5">
                                                        Examples: <code className="bg-gray-100 px-1">0 */3 * * *</code> = Every 3 hours
                                                    </p>
                                                </div>
                                            )}

                                            <div className="mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                                                <label className="flex items-start gap-3">
                                                    <input
                                                        type="checkbox"
                                                        checked={policy.fastMode}
                                                        onChange={e => {
                                                            const updated = [...networkPolicies];
                                                            updated[i].fastMode = e.target.checked;
                                                            setNetworkPolicies(updated);
                                                        }}
                                                        className="mt-1 w-4 h-4 text-blue-600 rounded"
                                                    />
                                                    <div className="flex-1">
                                                        <div className="font-medium text-gray-900 mb-1">Enable Fast Mode</div>
                                                        <div className="text-sm text-gray-600 mb-2">
                                                            Prioritize speed over accuracy for faster scans of large networks
                                                        </div>
                                                        <div className="text-xs text-gray-500 bg-white p-2 rounded border border-gray-200">
                                                            <strong>What it does:</strong> Reduces timeout values, uses fewer retries, 
                                                            and skips detailed checks for faster completion.
                                                        </div>
                                                    </div>
                                                </label>
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                                    Network Targets <span className="text-red-500">*</span>
                                                    <span className="block text-xs text-gray-500 font-normal mt-0.5">
                                                        CIDR notation networks to scan (one per line)
                                                    </span>
                                                </label>
                                                <textarea
                                                    value={policy.targets.join('\n')}
                                                    onChange={e => {
                                                        const updated = [...networkPolicies];
                                                        updated[i].targets = e.target.value.split('\n').filter(t => t.trim());
                                                        setNetworkPolicies(updated);
                                                    }}
                                                    placeholder="192.168.0.0/16&#10;10.0.0.0/8"
                                                    rows="4"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500"
                                                />
                                                <p className="text-xs text-gray-500 mt-1.5">
                                                    Examples: 192.168.1.0/24, 10.0.0.0/8, 172.16.0.0/12
                                                </p>
                                            </div>
                                        </div>
                                    ))}

                                    {networkPolicies.length === 0 && (
                                        <div className="text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
                                            <p className="text-gray-600 mb-3">No network discovery policies configured</p>
                                            <button 
                                                onClick={() => setNetworkPolicies([{
                                                    name: 'headquarters', schedule: '0 */2 * * *', scheduleComment: 'Every 2 hours', timeout: 5, fastMode: false, targets: ['192.168.0.0/16']
                                                }])}
                                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                                            >
                                                Create First Policy
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Device Discovery */}
                            {tab === 'device-discovery' && (
                                <div className="space-y-6">
                                    <div className="flex items-start justify-between">
                                        <div>
                                            <h2 className="text-xl font-bold text-gray-800 mb-1">Device Discovery Policies</h2>
                                            <p className="text-sm text-gray-600">
                                                Configure SSH connections to specific devices for detailed discovery
                                            </p>
                                        </div>
                                        <button